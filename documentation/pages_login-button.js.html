<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/login-button.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/login-button.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Creates a button element with the specified id and text, then appends it to the navigation list.
 * The button is styled with "btn" and "btn-primary" classes.
 *
 * @function createButton
 * @param {string} id - The id to assign to the button element.
 * @param {string} text - The text to display on the button.
 * @returns {HTMLElement} - The created button element.
 */
function createButton(id, text) {
    let element = document.createElement("button");
    element.id = id;
    element.innerText = text;
    element.classList.add("btn", "btn-primary");
    document.getElementById("ul-nav-id").appendChild(element);
    return element;
}

/**
 * Fetches the username and ID from the server and determines whether the user is logged in or not.
 * If the user is not logged in, it creates a "Login" button that opens a modal. 
 * If the user is logged in, it creates a "Logout" button that triggers a sign-out request to the server.
 * The sign-out request sends a POST request to the server to log the user out and reloads the page upon success.
 *
 * @function handleUserSession
 * @returns {void} - Creates either a login or logout button depending on the user's session status.
 */
fetch('/getUsernameAndId', {
    method: 'GET',
})
    .then(res => res.text())
    .then(res => {            
         console.log("res", res);

         if (res == "0") {
             const loginButton = createButton("button-entr", "Вхід");
             loginButton.setAttribute('data-toggle', "modal");
             loginButton.setAttribute('data-target', "#myModal");
         } else {
             const logoutButton = createButton("button-exit", "Вихід");
             logoutButton.onclick = function() {
                 var xhr = new XMLHttpRequest(); 
                 xhr.open('POST', '/signOut'); 
                 xhr.setRequestHeader('Content-Type', 'application/json'); 
                 xhr.send(JSON.stringify()); 

                 xhr.onload = function() {
                     if (xhr.status === 200) {
                         alert(this.responseText); 
                         location.reload();
                     }
                 }; 

                 xhr.onerror = function() {
                    if (xhr.status === 0) {
                        alert('Помилка підключення до сервера. Перевірте своє інтернет-з’єднання.');
                    } else {
                        alert(`Помилка сервера! Статус: ${xhr.status}. Спробуйте пізніше.`);
                    }
                };
             };
         }  
    });



/*fetch('/getUsernameAndId', {
    method: 'GET',
})
    .then(res => res.text())
    .then(res => {            
         
         console.log("res", res);
         if(res == "0") {
             let element = document.createElement("button");
             element.id = "button-entr";
             element.innerText = "Вхід";
             document.getElementById("ul-nav-id").appendChild(element);
             element.classList.add("btn", "btn-primary");
             element.setAttribute('data-toggle', "modal");
             element.setAttribute('data-target', "#myModal");
         }
         else {
            let element = document.createElement("button");
             element.id = "button-exit";
             element.innerText = "Вихід";
             document.getElementById("ul-nav-id").appendChild(element);
             element.classList.add("btn", "btn-primary");

            element.onclick = function () {
                var xhr = new XMLHttpRequest(); 
                xhr.open('POST', '/signOut'); 

                xhr.setRequestHeader('Content-Type', 'application/json'); 
                xhr.send(JSON.stringify()); 

                xhr.onload = function() {
                    if (xhr.status === 200) {
                        alert(this.responseText); 
                        location.reload();
                    }
                }; 

          xhr.onerror = function() {
              alert('server error!'); 
          }
            }
         }
    });*/


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AddFieldGenre">AddFieldGenre</a></li><li><a href="global.html#AddNewFilm">AddNewFilm</a></li><li><a href="global.html#AddNewGenreToDB">AddNewGenreToDB</a></li><li><a href="global.html#AddNewSession">AddNewSession</a></li><li><a href="global.html#AddNewSessionToDB">AddNewSessionToDB</a></li><li><a href="global.html#BuyTicket">BuyTicket</a></li><li><a href="global.html#ChangedSelection">ChangedSelection</a></li><li><a href="global.html#CloseConnectionToDB">CloseConnectionToDB</a></li><li><a href="global.html#ConnectToDB">ConnectToDB</a></li><li><a href="global.html#CreateElement">CreateElement</a></li><li><a href="global.html#CreateElementInput">CreateElementInput</a></li><li><a href="global.html#CreateTable2">CreateTable2</a></li><li><a href="global.html#DeleteFieldGenre">DeleteFieldGenre</a></li><li><a href="global.html#DeleteFilm">DeleteFilm</a></li><li><a href="global.html#DeleteFilmFromDB">DeleteFilmFromDB</a></li><li><a href="global.html#DeleteGenre">DeleteGenre</a></li><li><a href="global.html#DeleteGenreFromDB">DeleteGenreFromDB</a></li><li><a href="global.html#DeleteSession">DeleteSession</a></li><li><a href="global.html#DeleteSessionFromDB">DeleteSessionFromDB</a></li><li><a href="global.html#FillInFilmsStatisticsTable">FillInFilmsStatisticsTable</a></li><li><a href="global.html#FillInTables">FillInTables</a></li><li><a href="global.html#GET/getDaysWithSessions/:filmId">GET /getDaysWithSessions/:filmId</a></li><li><a href="global.html#GET/getFilmDetails/:filmId">GET /getFilmDetails/:filmId</a></li><li><a href="global.html#GET/getFilmIdsFromDB">GET /getFilmIdsFromDB</a></li><li><a href="global.html#GET/getFilmNamesFromDB">GET /getFilmNamesFromDB</a></li><li><a href="global.html#GET/getFilmsFromDB">GET /getFilmsFromDB</a></li><li><a href="global.html#GET/getFilmsStatisticsFromDB">GET /getFilmsStatisticsFromDB</a></li><li><a href="global.html#GET/getFirstAndLastName">GET /getFirstAndLastName</a></li><li><a href="global.html#GET/getGenresFromDB">GET /getGenresFromDB</a></li><li><a href="global.html#GET/getPosterNewFilmsFromDB">GET /getPosterNewFilmsFromDB</a></li><li><a href="global.html#GET/getRatingAllFilmsFromDB">GET /getRatingAllFilmsFromDB</a></li><li><a href="global.html#GET/getRatingFilmsFromDB">GET /getRatingFilmsFromDB</a></li><li><a href="global.html#GET/getSeats/:filmId/:date/:time">GET /getSeats/:filmId/:date/:time</a></li><li><a href="global.html#GET/getSessions/:filmId/:date">GET /getSessions/:filmId/:date</a></li><li><a href="global.html#GET/getSumOfAllVisitorsFromDB">GET /getSumOfAllVisitorsFromDB</a></li><li><a href="global.html#GET/getTotalProfitFromDB">GET /getTotalProfitFromDB</a></li><li><a href="global.html#GET/getUsernameAndId">GET /getUsernameAndId</a></li><li><a href="global.html#GET/isAdmin">GET /isAdmin</a></li><li><a href="global.html#OnChangeDates">OnChangeDates</a></li><li><a href="global.html#OnChangeDates2">OnChangeDates2</a></li><li><a href="global.html#POST/AddNewFilmToDB">POST /AddNewFilmToDB</a></li><li><a href="global.html#POST/getFilmsStatisticsForThePeriodFromDB">POST /getFilmsStatisticsForThePeriodFromDB</a></li><li><a href="global.html#POST/getSumOfAllVisitorsForThePeriodFromDB">POST /getSumOfAllVisitorsForThePeriodFromDB</a></li><li><a href="global.html#POST/getTotalProfitForThePeriodFromDB">POST /getTotalProfitForThePeriodFromDB</a></li><li><a href="global.html#POST/postBuyTicket">POST /postBuyTicket</a></li><li><a href="global.html#POST/postReviewToDB">POST /postReviewToDB</a></li><li><a href="global.html#PeriodChanged">PeriodChanged</a></li><li><a href="global.html#ResetContainerForForms">ResetContainerForForms</a></li><li><a href="global.html#SelectSeat">SelectSeat</a></li><li><a href="global.html#addOptionsDays">addOptionsDays</a></li><li><a href="global.html#addOptionsSessions">addOptionsSessions</a></li><li><a href="global.html#addSeats">addSeats</a></li><li><a href="global.html#checkAdminAndUpdateMenu">checkAdminAndUpdateMenu</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#createButton">createButton</a></li><li><a href="global.html#curry">curry</a></li><li><a href="global.html#fetchAndDisplayFilms">fetchAndDisplayFilms</a></li><li><a href="global.html#getSessionsFromDB">getSessionsFromDB</a></li><li><a href="global.html#handleUserSession">handleUserSession</a></li><li><a href="global.html#loadFilmPosters">loadFilmPosters</a></li><li><a href="global.html#loadFilmRatings">loadFilmRatings</a></li><li><a href="global.html#openModal">openModal</a></li><li><a href="global.html#queryPromise">queryPromise</a></li><li><a href="global.html#showFilmDetails">showFilmDetails</a></li><li><a href="global.html#validateForm">validateForm</a></li><li><a href="global.html#validatePassword">validatePassword</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Nov 11 2024 19:31:00 GMT+0200 (за східноєвропейським стандартним часом)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
